CREATE DATABASE UNIVERSIDAD
 
 USE UNIVERSIDAD
 
CREATE TABLE ESCUELA(
SCHOOL_CODE INT PRIMARY KEY NOT NULL,
SCHOOL_NAME VARCHAR(35) DEFAULT  'INSTITUTO TECNOLOGICO DE TIJUANA'
)


CREATE TABLE  EMPLEADO(
EM_NUM INT PRIMARY KEY NOT NULL,
EM_LNAME VARCHAR(20),
EM_FNAME VARCHAR(20),
EMP_INICIAL VARCHAR(2),
EMP_EMAIL VARCHAR(40))
 

CREATE TABLE DEPARTAMENTO(
DEP_CODE INT PRIMARY KEY NOT NULL,
DEP_NAME VARCHAR(30),
SCHOOL_CODE INT FOREIGN KEY REFERENCES ESCUELA(SCHOOL_CODE),
EM_NUM INT FOREIGN KEY REFERENCES EMPLEADO(EM_NUM))
 
 
CREATE TABLE PROFESOR(
EMP_NUM INT FOREIGN KEY  REFERENCES EMPLEADO(EM_NUM),
EMP_SPECIALTY VARCHAR(30),
EM_RANK VARCHAR(20),
DEP_CODE INT FOREIGN KEY REFERENCES DEPARTAMENTO(DEP_CODE))

CREATE TABLE ESTUDIANTE(
STU_NUM INT PRIMARY KEY NOT NULL,
STU_LNAME VARCHAR(20),
STU_FNAME VARCHAR(20),
STU_INICIAL VARCHAR(2),
STU_EMAIL VARCHAR(20),
EMP_NUM INT FOREIGN KEY REFERENCES EMPLEADO(EM_NUM),
DEP_CODE INT FOREIGN KEY REFERENCES DEPARTAMENTO(DEP_CODE))


CREATE TABLE EDIFICIO(
BLDG_CODE INT PRIMARY KEY NOT NULL,
BLDG_LOCATION VARCHAR(30))


 
CREATE TABLE SALON(
ROOOM_CODE INT PRIMARY KEY ,
ROOM_TYPE VARCHAR(25),
BLDG_CODE INT FOREIGN KEY REFERENCES  EDIFICIO(BLDG_CODE))



CREATE TABLE CURSO(
CRS_CODE INT PRIMARY KEY NOT NULL,
CRS_TITLE VARCHAR(20),
CRS_DESCRIPCION VARCHAR(30),
CRS_CREDITOS INT,
DEP_CODE INT FOREIGN KEY REFERENCES DEPARTAMENTO(DEP_CODE))
 
 
CREATE TABLE CLASE(
CLASS_CODE INT PRIMARY KEY NOT NULL,
CLASSTIME VARCHAR(30),
EMP_NUM INT FOREIGN KEY REFERENCES  EMPLEADO(EM_NUM),
ROOM_CODE INT FOREIGN KEY REFERENCES SALON(ROOOM_CODE),
CRS_CODE INT FOREIGN KEY REFERENCES CURSO(CRS_CODE))


CREATE TABLE INSCRIPCION(
CLASS_CODE INT FOREIGN KEY REFERENCES CLASE(CLASS_CODE),
STU_NUM INT FOREIGN KEY REFERENCES ESTUDIANTE(STU_NUM),
ENROLL_DATE DATETIME NOT NULL DEFAULT GETDATE(),
ENROOLL_GRADE INT)





--VER TABLA
SELECT * FROM INSCRIPCION
SELECT * FROM EDIFICIO
SELECT * FROM CLASE
SELECT * FROM CURSO
SELECT * FROM SALON
SELECT * FROM ESTUDIANTE
SELECT * FROM PROFESOR
SELECT * FROM DEPARTAMENTO
SELECT * FROM EMPLEADO
SELECT * FROM ESCUELA



--En la Tabla Empleado, el atributo Emp_num debe tener un valor entre 1 y 9999

CREATE RULE NUMEROEMP
AS @EM_NUM>=1  AND  @EM_NUM< 999
EXEC SP_BINDRULE NUMEROEMP,'EMPLEADO.EM_NUM'

--En la tabla CURSO el atributo CRS_Credits debe tener un valor mayor que 1 y menor que 8.
CREATE RULE CRS_CREDITS
AS @CRS_CREDIT>1  AND  @CRS_CREDIT<8
EXEC SP_BINDRULE CRS_CREDITS,'CURSO.CRS_CREDITOS'

--En la tabla SALON el atributo ROOM_TYPE solo puede tener valores como: Laboratorio, Salón, Audiovisual.
CREATE RULE ROOM_TYPE
AS @LIST IN ('LABORATORIO','SALON','AUDIOVISUAL')
EXEC SP_BINDRULE  ROOM_TYPE,'SALON.ROOM_TYPE'

--Los atributos de correo, como son: EMP_E_MAIL y STU_E_MAIL entre otros deben  tener de manera obligada el carácter @ intermedio al texto.

CREATE RULE EMAILEMP
AS @EMP_EMAIL  like '%@%'

CREATE RULE EMAILES 
AS @STU_EMAIL  like '%@%' 

exec sp_bindrule EMAILEMP,'EMPLEADO.EMP_EMAIL'
exec sp_bindrule EMAILES,'ESTUDIANTE.STU_EMAIL'

-- RESTRICCION CHECK
ALTER TABLE PROFESOR
ADD CONSTRAINT ESPI
CHECK(EMP_SPECIALTY in ('SISTEMAS','INFORMATICA', 'TECNOLOGIAS'))


-- 3 REGISTROS A CADA TABLA

INSERT INTO ESCUELA VALUES(2385,'UTT')
INSERT INTO ESCUELA VALUES(1961,DEFAULT)
INSERT INTO ESCUELA VALUES(1931,'UABC')

INSERT INTO EMPLEADO VALUES(2,'MORALES','KAREN','MK','KAREN.MOR@HOTMAIL.COM')
INSERT INTO EMPLEADO VALUES(1,'CHAVEZ','MARYURI','CM','MARYURI.CHAVEZ@HOTMAIL.COM')
INSERT INTO EMPLEADO VALUES(3,'MORENO','MARIA','MM','MARI.MORENO@HOTMAIL.COM')

INSERT INTO DEPARTAMENTO VALUES(102,'SISTEMAS',1961,3)
INSERT INTO DEPARTAMENTO VALUES(103,'INDUSTRIAL',1961,2)
INSERT INTO DEPARTAMENTO VALUES(104,'ELECTRONICA',1961,1)

 INSERT INTO PROFESOR VALUES(1,'SISTEMAS','DOCTOR',102)
 INSERT INTO PROFESOR VALUES(2,'TECNOLOGIAS','DOCTOR',102)
 INSERT INTO PROFESOR VALUES(3,'INFORMATICA','DOCTOR',102)

 
INSERT INTO ESTUDIANTE VALUES(1621093,'RODRIGUEZ','MANUEL','RM','Mane@hotmail.com',1,102)
INSERT INTO ESTUDIANTE VALUES(1621035,'HERNANDEZ','YARA','HR','Yara@hotmail.com',1,102)
INSERT INTO ESTUDIANTE VALUES(1621078,'ESCOBEDO','JESUS','EJ','Edu@hotmail.com',1,102)

INSERT INTO EDIFICIO VALUES(300,'5AISC'),(500,'3BISC'),(301,'4BISC')

INSERT INTO SALON VALUES(301,'SALON',300),(501,'LABORATORIO',500),(510,'AUDIOVISUAL',500)
 

 INSERT INTO CURSO VALUES(300,'PROG. WEB','PROGRAMADOR DE SOFTWARE',2,102),
                         (400,'PROG. MOVIL','PROGRAMADOR DE SOFTWARE',5,102), 
                         (200,'PROG. ARDUINO','PROGRAMADOR DE SOFTWARE',3,102)


INSERT INTO CLASE VALUES(1025,'12:00-13:00',1,301,300)
INSERT INTO CLASE VALUES(1035,'7:00-8:00',2,501,400)
INSERT INTO CLASE VALUES(1005,'15:00-16:00',1,510,200)

INSERT INTO INSCRIPCION VALUES(1005,1621035,DEFAULT,6),
                              (1025,1621078,DEFAULT,4),
							  (1035,1621093,DEFAULT,2)

--- CREACION DE LAS VISTAS


CREATE VIEW Vista_EDIFICIO as
select * from EDIFICIO


CREATE VIEW Vista_SALON AS
SELECT * FROM SALON


CREATE VIEW Vista_EMPLEADO AS
SELECT TOP 1000 * FROM EMPLEADO ORDER BY EMPLEADO.EM_LNAME ASC


CREATE VIEW Vista_ESCUELA AS
SELECT * FROM ESCUELA


CREATE VIEW Vista_DEPARTAMENTO AS
SELECT * FROM DEPARTAMENTO


CREATE VIEW Vista_PROFESOR AS
SELECT * FROM PROFESOR


CREATE VIEW Vista_CURSO AS
SELECT TOP 1000 * FROM CURSO ORDER BY CURSO.CRS_TITLE ASC


CREATE VIEW Vista_ESTUDIANTE AS
SELECT TOP 1000 * FROM ESTUDIANTE ORDER BY ESTUDIANTE.STU_LNAME ASC


CREATE VIEW Vista_CLASE AS
SELECT * FROM CLASE


CREATE VIEW Vista_INSCRIPCION AS
SELECT * FROM INSCRIPCION

-- CONSULTAS DE LAS VISTAS

select * from Vista_EDIFICIO
select * from Vista_SALON
select * from Vista_EMPLEADO
select * from Vista_ESCUELA
select * from Vista_DEPARTAMENTO
select * from Vista_PROFESOR
select * from Vista_CURSO
select * from Vista_ESTUDIANTE
select * from Vista_CLASE
select * from Vista_INSCRIPCION
 


