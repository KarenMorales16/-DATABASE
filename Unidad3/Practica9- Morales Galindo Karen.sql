CREATE DATABASE PRAC09
USE PRAC09

CREATE TABLE AGENTE(
ID_AGENTE INT PRIMARY KEY NOT NULL,
NOMBRE VARCHAR(60),
RFC VARCHAR(20))

CREATE TABLE POLIZA(
ID_POLIZA INT PRIMARY KEY NOT NULL,
TIPO_POLIZA VARCHAR(20),
FECHAEMISION DATE,
FECHAVENCIMIENTO DATE,
COSTO MONEY,
ID_AGENTE INT FOREIGN KEY REFERENCES AGENTE(ID_AGENTE))


INSERT INTO AGENTE VALUES (1,'Karen Nohemi','MOGK971019R00')
INSERT INTO AGENTE VALUES (2,'Maryuri Chavez','MOGK971019M00')
INSERT INTO AGENTE VALUES (3,'Yahara Hernandez','MOGK971015R00')
//
INSERT INTO POLIZA VALUES(100,'VIDA','7/10/1995','10/02/1997',0,1)
INSERT INTO POLIZA VALUES(101,'VIDA','7/10/1995','10/02/1997',5000,2)
INSERT INTO POLIZA VALUES(102,'VIDA','7/10/1995','10/02/1997',10001,3)
INSERT INTO POLIZA VALUES(103,'VIDA','7/10/1995','10/02/1997',15000,2)
INSERT INTO POLIZA VALUES(104,'VIDA','7/10/1995','10/02/1997',15001,2)
INSERT INTO POLIZA VALUES(105,'VIDA','7/10/1995','10/02/1997',5001,2)

--FUNCION BONO

CREATE function dbo.BON(@COSTO MONEY)
RETURNS MONEY
AS
BEGIN
DECLARE @BONOS MONEY 
SET @BONOS=
CASE
WHEN @COSTO>=5000 AND @COSTO<=10000 THEN .10
WHEN @COSTO>10000 AND @COSTO<=15000 THEN .12
WHEN @COSTO>15000 THEN .15
WHEN @COSTO<5000 THEN .0
ELSE 0
END 
RETURN @BONOS
END


CREATE TABLE AGENTE(
ID_AGENTE INT PRIMARY KEY NOT NULL,
NOMBRE VARCHAR(60),
RFC VARCHAR(20))

CREATE TABLE POLIZA(
ID_POLIZA INT PRIMARY KEY NOT NULL,
TIPO_POLIZA VARCHAR(20),
FECHAEMISION DATE,
FECHAVENCIMIENTO DATE,
COSTO MONEY,
ID_AGENTE INT FOREIGN KEY REFERENCES AGENTE(ID_AGENTE))


SELECT  POLIZA.ID_AGENTE,AGENTE.NOMBRE,AGENTE.RFC,
DBO.BON(POLIZA.COSTO) AS 'PORCENTAJE' ,DBO.BON(POLIZA.COSTO)*POLIZA.COSTO AS 'BONO'  FROM (POLIZA INNER JOIN  AGENTE ON AGENTE.ID_AGENTE=POLIZA.ID_AGENTE)
